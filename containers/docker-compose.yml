version: '3.4'
services:
    simulation:
        image: robot_rest_api
        network_mode: host
        command: bash -c "pkill Xvfb; rm /tmp/.X1-lock; Xvfb :1 -screen scrn 640x480x16 & export DISPLAY=:1 && roslaunch mir_experiments sim_untidy_small_hospital_room.launch gui:=false gui_teleop:=false"
    changes:
        image: robot_rest_api
        network_mode: host
        command: bash -c "sleep 10; roslaunch mir_experiments changes_based_on_tidy_small_room_depth_camera.launch"
        depends_on:
            - simulation
    un_pause_simulation:
        image: robot_rest_api
        network_mode: host
        command: bash -c "sleep 10; rosservice call /gazebo/unpause_physics \"{}\""
        depends_on:
            - simulation
    dummy_teleop:
        image : robot_rest_api
        network_mode: host
        command: bash -c " sleep 5; rostopic pub /cmd_vel geometry_msgs/Twist \"[0.0, 0.0, 0.0]\" \"[0.0, 0.0, 0.5]\" -r 10"
        depends_on:
            - simulation
            - changes
            - un_pause_simulation
    rosbridge_server:
        image : robot_rest_api
        network_mode: host
        command: bash -c "sleep 5; roslaunch rosbridge_server rosbridge_websocket.launch"
        depends_on:
            - simulation
            - changes
            - un_pause_simulation
    tf2_web_republisher:
        image : robot_rest_api
        network_mode: host
        command: bash -c "sleep 5; rosrun tf2_web_republisher tf2_web_republisher"
        depends_on:
            - simulation
            - changes
            - un_pause_simulation
            - rosbridge_server
    octomap_mapping:
        image : robot_rest_api
        network_mode: host
        command: bash -c "sleep 5; roslaunch mir_experiments octomap_mapping_depth_camera.launch"
        depends_on:
            - simulation
            - changes
            - un_pause_simulation
            - rosbridge_server
            - tf2_web_republisher
    ros_rvv:
        image : robot_rest_api
        network_mode: host
        command: bash -c "sleep 5; rosrun ros_rvv rvv.py"
        depends_on:
            - simulation
            - changes
            - un_pause_simulation
            - rosbridge_server
            - tf2_web_republisher
            - octomap_mapping
    apache_server:
        image : robot_rest_api
        network_mode: host
        command: apachectl -D FOREGROUND
        depends_on:
            - simulation
            - changes
            - un_pause_simulation
            - rosbridge_server
            - tf2_web_republisher
            - octomap_mapping
        # ports:
            # - "8080:80"


